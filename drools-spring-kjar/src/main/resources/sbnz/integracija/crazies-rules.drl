package com.catoni;

import com.catoni.models.enums.*;
import com.catoni.models.*;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.concurrent.ThreadLocalRandom;
import java.util.HashMap;
import java.util.Map;


rule "Play YEAR_OF_PLENTY to build a house"
    salience 5
    when


        $is: InputState(
            playerStates.get("bot").getCraziesList().contains(CrazyTypes.YEAR_OF_PLENTY) && (
            (resources.contains(ResourceTypes.WOOD) && resources.contains(ResourceTypes.CLAY)) ||
            (resources.contains(ResourceTypes.WOOD) && resources.contains(ResourceTypes.GRAIN)) ||
            (resources.contains(ResourceTypes.WOOD) && resources.contains(ResourceTypes.SHEEP)) ||
            (resources.contains(ResourceTypes.CLAY) && resources.contains(ResourceTypes.GRAIN)) ||
            (resources.contains(ResourceTypes.CLAY) && resources.contains(ResourceTypes.SHEEP)) ||
            (resources.contains(ResourceTypes.GRAIN) && resources.contains(ResourceTypes.SHEEP)))
        )
        $m: Move()

    then
        $m.setObjects($is.getResources());
        $m.setMove(MoveTypes.PLAY_YEAR_OF_PLENTY);
        update($m);
end

rule "Draw resources for a house after playing YEAR_OF_PLENTY"
    salience 6
    when

        $is: InputState()
        $m: Move( move == MoveTypes.PLAY_YEAR_OF_PLENTY )

    then
        boolean hasWood = false;
        boolean hasClay = false;
        boolean hasGrain = false;
        boolean hasSheep = false;

        List<ResourceTypes> available = $m.getObjects();

        System.out.println("Resources before checking what card to draw: " + available);

        int drawedCards = 0;

        if (available.contains(ResourceTypes.WOOD) == false) {
            available.add(ResourceTypes.WOOD);
            drawedCards++;
        }

        if (available.contains(ResourceTypes.CLAY) == false) {
            available.add(ResourceTypes.CLAY);
            drawedCards++;
        }

        if (available.contains(ResourceTypes.GRAIN) == false) {
            available.add(ResourceTypes.GRAIN);
            drawedCards++;
        }

        if (available.contains(ResourceTypes.SHEEP) == false) {
            available.add(ResourceTypes.SHEEP);
            drawedCards++;
        }

        if (drawedCards == 1) {
            List<ResourceTypes> allTypes = new ArrayList<>();
            allTypes.add(ResourceTypes.WOOD);
            allTypes.add(ResourceTypes.CLAY);
            allTypes.add(ResourceTypes.GRAIN);
            allTypes.add(ResourceTypes.SHEEP);
            allTypes.add(ResourceTypes.ROCK);
            int randomNum = ThreadLocalRandom.current().nextInt(0, 5);
            available.add(allTypes.get(randomNum));
        }

        System.out.println("Available resources after playing crazy and drawing cards: " + available);
        State myPlayerState = $is.getPlayerStates().get("bot");
        myPlayerState.setCraziesList(new ArrayList<>());
        Map<String, State> newState = new HashMap<>();
        newState.put("bot", myPlayerState);
        modify($is) {setResources(available), setPlayerStates(newState)};
        modify($m) {setMove(MoveTypes.END_TURN)};
end
